<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HEP Hub: Post-Rehab Exercise Library and Prescription Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1f2937; /* Very dark gray/deep charcoal for professional dark theme */
            color: #d1d5db; /* Default light text color */
        }
        /* Custom scrollbar for aesthetics */
        body::-webkit-scrollbar {
            width: 8px;
        }
        body::-webkit-scrollbar-thumb {
            background-color: #374151; /* Darker gray for contrast */
            border-radius: 10px;
        }
        
        .card {
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.25); /* Darker shadow for dark background */
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: grab; /* Indicates draggable */
        }
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 16px 25px rgba(6, 182, 212, 0.4); /* Cyan hover glow on dark background */
        }
        .drag-over {
            border: 3px dashed #06b6d4; /* Cyan dashed border on drag over */
            background-color: #1f3248; /* Slightly lighter dark background */
        }

        /* Color-coding classes using the requested palette */
        .strength-border { border-left: 6px solid #1e3a8a; } /* Navy Blue */
        .stretching-border { border-left: 6px solid #ea580c; } /* Orange */
        .balance-border { border-left: 6px solid #0d9488; } /* Teal */
        .functional-border { border-left: 6px solid #4f46e5; } /* Indigo/Functional Accent */
        .motor-control-border { border-left: 6px solid #15803d; } /* Deep Green */

        /* Styles for the draggable Prescription Pad */
        #hepPad {
            transition: all 0.3s ease;
            max-height: calc(100vh - 140px); /* Set max height for sticky area */
            overflow-y: auto;
        }
        #hepPad::-webkit-scrollbar { width: 4px; }
        #hepPad::-webkit-scrollbar-thumb { background-color: #0d9488; border-radius: 4px; }
    </style>
</head>
<body class="p-0 sm:p-4 md:p-8">

    <!-- JUMP TO BOTTOM BUTTON (Kept for navigation in long exercise list) -->
    <button id="jumpToBottom" class="fixed bottom-6 right-6 p-4 bg-orange-500 text-white rounded-full shadow-lg hover:bg-orange-600 transition-all z-50 transform active:scale-95">
        <!-- Arrow Down Icon -->
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
    </button>
    
    <!-- MESSAGE BOX (Replaces alert/confirm) -->
    <div id="messageBox" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden z-50 flex items-center justify-center">
        <div class="bg-gray-800 p-6 rounded-xl shadow-2xl max-w-sm w-full border-t-4 border-teal-500">
            <h4 id="messageTitle" class="text-xl font-bold text-teal-400 mb-3"></h4>
            <p id="messageBody" class="text-gray-300 mb-4"></p>
            <button id="messageCloseBtn" class="w-full py-2 bg-teal-600 text-white font-semibold rounded-lg hover:bg-teal-700 transition-colors">Close</button>
        </div>
    </div>


    <div class="max-w-7xl mx-auto">
        
        <!-- Header Section (Sticky) -->
        <header class="sticky top-0 z-40 mb-8 p-6 bg-blue-900 text-white rounded-b-2xl shadow-2xl transition-all">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="text-center md:text-left">
                    <h1 class="text-4xl sm:text-5xl font-extrabold text-white flex items-center justify-center md:justify-start">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 mr-3 text-teal-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>
                        HEP Hub
                    </h1>
                    <p class="text-lg sm:text-xl font-medium text-teal-300 mt-1">
                        Post-Rehab Exercise Library and Prescription Platform
                    </p>
                    <p id="authStatus" class="text-xs text-gray-400 mt-1">
                        Authenticating...
                    </p>
                </div>
                
                <!-- Action Buttons & View Switcher -->
                <div class="flex flex-wrap justify-center md:justify-end gap-3 w-full md:w-auto">
                    <button id="viewSwitcherBtn" class="px-5 py-2.5 bg-orange-500 text-white font-semibold rounded-lg shadow-md hover:bg-orange-600 transition-colors">
                        View Programs
                    </button>
                    <!-- Mock link kept for context -->
                    <a href="#" class="px-5 py-2.5 bg-gray-700 text-white font-semibold rounded-lg shadow-md hover:bg-gray-600 transition-colors flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><polygon points="10 8 16 12 10 16 10 8"></polygon></svg>
                        Video Library
                    </a>
                </div>
            </div>
        </header>

        <!-- Main Content Area: Divided into Library View and Programs View -->
        <main class="p-4 sm:p-0">

            <!-- 1. EXERCISE LIBRARY VIEW -->
            <div id="libraryView" class="view-content">
                
                <!-- Color Key and Legend (FIXED STYLING) -->
                <section class="mb-8 p-6 bg-gray-800 rounded-xl shadow-xl border-t-4 border-teal-500">
                    <h2 class="text-2xl font-bold text-teal-400 mb-6 border-b pb-2 border-gray-700">Exercise Color Key (Drag exercises into the HEP Pad on the right)</h2>
                    
                    <!-- Updated Grid for Color Key -->
                    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-6 text-base font-semibold text-gray-100">
                        <div class="flex items-center p-3 rounded-lg bg-gray-900 hover:shadow-lg transition-shadow">
                            <span class="w-4 h-4 rounded-full mr-3 bg-blue-900"></span>
                            Strength Training
                        </div>
                        <div class="flex items-center p-3 rounded-lg bg-gray-900 hover:shadow-lg transition-shadow">
                            <span class="w-4 h-4 rounded-full mr-3 bg-orange-600"></span>
                            Stretching/Flexibility
                        </div>
                        <div class="flex items-center p-3 rounded-lg bg-gray-900 hover:shadow-lg transition-shadow">
                            <span class="w-4 h-4 rounded-full mr-3 bg-teal-600"></span>
                            Balance/Coordination
                        </div>
                        <div class="flex items-center p-3 rounded-lg bg-gray-900 hover:shadow-lg transition-shadow">
                            <span class="w-4 h-4 rounded-full mr-3 bg-indigo-700"></span>
                            Functional Exercise
                        </div>
                        <div class="flex items-center p-3 rounded-lg bg-gray-900 hover:shadow-lg transition-shadow">
                            <span class="w-4 h-4 rounded-full mr-3 bg-green-800"></span>
                            Motor Control
                        </div>
                    </div>
                </section>

                <!-- Search and Two-Column Layout -->
                <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
                    
                    <!-- 1. LIBRARY SECTION (2/3 width) -->
                    <section class="xl:col-span-2">
                        <!-- Search and Filter Bar (Now dark background) -->
                        <div class="mb-8 relative">
                            <svg xmlns="http://www.w3.org/2000/svg" class="absolute left-4 top-1/2 transform -translate-y-1/2 w-6 h-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                            <input id="searchInput" type="text" placeholder="Search by name, injury (e.g., ACL, Low Back), category, or phase..." 
                                class="w-full pl-12 pr-4 py-4 border-2 border-gray-600 rounded-xl shadow-lg focus:outline-none focus:ring-4 focus:ring-teal-400 transition duration-300 text-lg bg-gray-900 text-gray-100 placeholder-gray-400">
                        </div>

                        <!-- Exercise Library Title -->
                        <h2 class="text-3xl font-extrabold text-gray-100 mb-6 border-b-2 pb-3 border-teal-500">
                            Exercise Library (<span id="exerciseCount"></span> items)
                        </h2>

                        <!-- Results Container -->
                        <div id="resultsContainer" class="w-full grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Exercise cards will be rendered here -->
                        </div>

                        <div id="noResults" class="hidden text-center p-12 bg-gray-800 rounded-xl shadow-lg text-gray-400 mt-10">
                            <p class="text-xl font-semibold">No Exercises Match Your Search.</p>
                            <p class="mt-2">Try a different keyword or check the categories in the Color Key above.</p>
                        </div>
                    </section>

                    <!-- 2. PRESCRIPTION PAD (1/3 width, Sticky) -->
                    <aside class="xl:col-span-1 hidden xl:block">
                        <div id="hepPad" 
                            class="sticky top-32 p-6 bg-gray-800 rounded-xl shadow-2xl border-4 border-dashed border-teal-300 flex flex-col items-center justify-start h-[calc(100vh-140px)]"
                            ondragover="handleDragOver(event)" 
                            ondrop="handleDrop(event)"
                            ondragleave="handleDragLeave(event)">
                            
                            <h3 class="text-2xl font-extrabold text-teal-400 mb-4 border-b pb-2 w-full text-center border-gray-700">
                                Current Prescription
                            </h3>
                            
                            <div id="hepPadContent" class="w-full space-y-4 overflow-y-auto flex-grow">
                                <!-- Selected exercises will be rendered here -->
                            </div>

                            <p id="hepPadEmptyMessage" class="text-gray-400 text-center mt-8 absolute top-1/2 transform -translate-y-1/2">
                                Drag and drop exercises here to build a custom Home Exercise Program.
                            </p>


                            <button id="prescribeButton" class="w-full mt-4 py-3 bg-teal-600 text-white font-semibold rounded-lg shadow-xl hover:bg-teal-700 transition-colors disabled:opacity-50" disabled>
                                Generate and Save HEP (0 Exercises)
                            </button>

                        </div>
                    </aside>
                </div>
            </div>

            <!-- 2. PATIENT PROGRAMS VIEW -->
            <div id="programsView" class="view-content hidden">
                <h2 class="text-3xl font-extrabold text-gray-100 mb-6 border-b-2 pb-3 border-orange-500">
                    Saved Patient Programs
                </h2>
                <div class="p-6 bg-gray-800 rounded-xl shadow-xl border-t-4 border-orange-500 min-h-64">
                    <p class="text-gray-400 mb-4">Your programs are secured and linked to your user ID (<span id="currentUserId" class="font-mono text-xs text-orange-300"></span>).</p>
                    
                    <!-- Loading State -->
                    <div id="programsLoading" class="text-center p-12 text-gray-400">
                        <div class="animate-spin inline-block w-6 h-6 border-4 border-teal-500 border-t-transparent rounded-full mr-2"></div>
                        Loading patient data...
                    </div>

                    <!-- Programs List Container -->
                    <div id="programsList" class="space-y-4">
                        <!-- Patient program cards will be rendered here -->
                    </div>

                    <!-- Empty State -->
                    <div id="programsEmpty" class="hidden text-center p-12 bg-gray-900 rounded-lg text-gray-400 mt-4">
                        <p class="text-xl font-semibold">No Programs Saved Yet.</p>
                        <p class="mt-2">Switch to the Exercise Library to create your first Home Exercise Program.</p>
                    </div>
                </div>
                
                <!-- Detailed View Modal -->
                <div id="detailModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden z-50 flex items-center justify-center p-4">
                    <div class="bg-gray-800 p-8 rounded-xl shadow-2xl max-w-2xl w-full border-t-4 border-orange-500 max-h-[90vh] overflow-y-auto">
                        <h4 id="detailPatientName" class="text-2xl font-bold text-orange-400 mb-4 border-b pb-2 border-gray-700"></h4>
                        <div id="detailProgramExercises" class="space-y-3 mb-6">
                            <!-- Detailed exercises will be inserted here -->
                        </div>
                        <button id="detailCloseBtn" class="w-full py-2 bg-teal-600 text-white font-semibold rounded-lg hover:bg-teal-700 transition-colors">Close</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer for Scroll Target -->
        <footer id="footer" class="mt-12 p-6 text-center text-gray-400 text-sm bg-gray-800 rounded-xl shadow-inner">
            <p>&copy; 2024 HEP Hub. Specialized Post-Rehab Exercise Platform.</p>
            <p class="mt-2">User ID: <span id="footerUserId" class="font-mono text-xs text-gray-500">N/A</span>. Data stored securely using Firestore.</p>
        </footer>

    </div>

    <!-- Firebase SDK Imports -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, addDoc, onSnapshot, deleteDoc, query, where, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // setLogLevel('Debug'); // Uncomment to see Firebase logs

        // Global variables provided by the Canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db = null;
        let auth = null;
        let userId = null;
        let authReady = false;
        
        const programsCollectionPath = `/artifacts/${appId}/users/`; // Path prefix

        // --- Firebase Initialization and Auth ---
        if (firebaseConfig) {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                // Auth State Listener
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        document.getElementById('authStatus').textContent = `Authenticated as: ${userId}`;
                        document.getElementById('currentUserId').textContent = userId;
                        document.getElementById('footerUserId').textContent = userId;
                        authReady = true;
                        // Once authenticated, start listening for programs
                        fetchPrograms(); 
                    } else {
                        userId = crypto.randomUUID(); // Fallback ID if auth fails or is anonymous
                        document.getElementById('authStatus').textContent = `Signed out. User ID: ${userId.substring(0, 8)}...`;
                        document.getElementById('currentUserId').textContent = userId.substring(0, 8) + '...';
                        document.getElementById('footerUserId').textContent = userId.substring(0, 8) + '...';
                        authReady = true;
                        // Even if anonymous, we still want to try fetching any anonymous data
                        fetchPrograms(); 
                    }
                });

                // Sign in using custom token or anonymously
                if (initialAuthToken) {
                    signInWithCustomToken(auth, initialAuthToken).catch(error => {
                        console.error("Custom token sign-in failed:", error);
                        signInAnonymously(auth); // Fallback to anonymous
                    });
                } else {
                    signInAnonymously(auth); // Sign in anonymously if no token is provided
                }

            } catch (e) {
                console.error("Firebase initialization failed:", e);
                showMessage("Error", "Could not initialize the database. Program saving disabled.");
            }
        } else {
            document.getElementById('authStatus').textContent = "Database config missing. Saving disabled.";
            console.error("Firebase config is missing.");
        }


        // --- FIREBASE DATA FUNCTIONS ---
        
        let programsSnapshotUnsubscribe = null;
        const patientPrograms = window.patientPrograms = []; // Array to store programs globally

        function getProgramsRef() {
            // Path: /artifacts/{appId}/users/{userId}/programs
            return collection(db, `${programsCollectionPath}${userId}/programs`);
        }

        /**
         * Listens in real-time for changes to the user's saved programs.
         */
        function fetchPrograms() {
            if (!authReady || !db || programsSnapshotUnsubscribe) return;
            
            const programsRef = getProgramsRef();
            const q = query(programsRef);

            programsSnapshotUnsubscribe = onSnapshot(q, (snapshot) => {
                patientPrograms.length = 0; // Clear the array
                snapshot.forEach((doc) => {
                    patientPrograms.push({ id: doc.id, ...doc.data() });
                });
                
                // Sort by creation date (newest first)
                patientPrograms.sort((a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));
                
                renderProgramsList();
                document.getElementById('programsLoading').classList.add('hidden');
                console.log(`Loaded ${patientPrograms.length} programs.`);
            }, (error) => {
                console.error("Error fetching programs:", error);
                document.getElementById('programsLoading').innerHTML = `<p class="text-red-400">Error loading programs: ${error.message}</p>`;
            });
        }


        /**
         * Saves the current HEP Pad exercises as a new patient program.
         */
        window.saveProgram = async function (patientName, exercises) {
            if (!authReady || !db) {
                showMessage("Error", "Authentication not complete. Cannot save program.");
                return;
            }

            if (exercises.length === 0) {
                showMessage("Error", "The Prescription Pad is empty. Please drag exercises first.");
                return;
            }
            
            try {
                const programsRef = getProgramsRef();
                await addDoc(programsRef, {
                    patientName: patientName,
                    exercises: exercises,
                    therapistId: userId,
                    timestamp: serverTimestamp()
                });
                showMessage("Success", `Program saved successfully for patient: ${patientName}`);
                window.selectedExercises = []; // Clear the pad after saving
                window.renderHEPPad();
            } catch (e) {
                console.error("Error saving document: ", e);
                showMessage("Error", "Failed to save program to database. Check console for details.");
            }
        }
        
        /**
         * Deletes a program from Firestore.
         */
        window.deleteProgram = async function (programId) {
            if (!authReady || !db) {
                showMessage("Error", "Authentication not complete. Cannot delete program.");
                return;
            }
            
            // NOTE: Using window.prompt instead of confirm due to the rule against alert/confirm
            const confirmation = prompt(`Type 'DELETE' to confirm removing this program forever:`);
            if (confirmation !== 'DELETE') {
                return;
            }

            try {
                const programDocRef = doc(db, `${programsCollectionPath}${userId}/programs`, programId);
                await deleteDoc(programDocRef);
                showMessage("Deleted", "Program successfully deleted.");
                // onSnapshot listener handles re-rendering the list automatically
            } catch (e) {
                console.error("Error deleting document: ", e);
                showMessage("Error", "Failed to delete program. Check console for details.");
            }
        }
    </script>
    
    <!-- Application Logic -->
    <script type="text/javascript">
        // --- DATA: Massive library of over 230 Specialized Post-Rehab Exercises ---
        const exercises = [
            // STRENGTH TRAINING (Navy Blue) - 50 Exercises
            { id: 1, name: "Single-Leg Press (Unloaded)", category: "Strength Training", focus: "Quads, Glutes", injury: "Knee (ACL/MCL)", setsReps: "3x15", phase: "Early-Mid Rehab", description: "Controlled eccentric lowering for neuromuscular control and initial strength building." },
            { id: 2, name: "Rotator Cuff Isometric Holds (Subscap)", category: "Strength Training", focus: "Rotator Cuff", injury: "Shoulder Impingement", setsReps: "3x10s", phase: "Acute/Early Rehab", description: "Gentle co-contraction for stability without movement. Press into wall/door frame." },
            { id: 3, name: "Banded Hip Abduction (Clamshell)", category: "Strength Training", focus: "Glute Medius", injury: "Hip, Low Back", setsReps: "3x20", phase: "Mid Rehab", description: "Focus on isolating the lateral hip stabilizers. Avoid pelvic rotation." },
            { id: 4, name: "Prone Scapular Squeeze (Y/T/W)", category: "Strength Training", focus: "Scapular Stabilizers", injury: "Postural Syndrome", setsReps: "3x10", phase: "Mid Rehab", description: "Strengthening mid-back musculature for improved posture and shoulder mechanics." },
            { id: 5, name: "Split Squat (2-inch lift)", category: "Strength Training", focus: "Lower Body", injury: "Ankle Sprain", setsReps: "3x10/leg", phase: "Late Rehab", description: "Increase depth gradually to challenge range of motion and unilateral leg strength." },
            { id: 6, name: "Eccentric Calf Raises (Slow)", category: "Strength Training", focus: "Calves, Achilles", injury: "Achilles Tendinopathy", setsReps: "3x12", phase: "Late Rehab", description: "Focus on a 4-second lowering phase to rebuild tendon tolerance." },
            { id: 7, name: "Lateral Step-Ups (Box)", category: "Strength Training", focus: "Glutes, Quads", injury: "Knee Pain", setsReps: "3x12/leg", phase: "Mid Rehab", description: "Improves hip strength and frontal plane stability." },
            { id: 8, name: "Dumbbell Row (Neutral Grip)", category: "Strength Training", focus: "Upper Back", injury: "Thoracic Outlet Syndrome", setsReps: "3x10", phase: "Mid Rehab", description: "Strengthens back extensors and retractors to relieve shoulder/neck tension." },
            { id: 9, name: "Weighted Glute Bridge (Hold)", category: "Strength Training", focus: "Glutes, Hamstrings", injury: "Sacroiliac Joint Dysfunction", setsReps: "3x12", phase: "Mid Rehab", description: "Maximal glute contraction at the top; avoid hyperextending the low back." },
            { id: 10, name: "Incline Push-ups (Hands on wall)", category: "Strength Training", focus: "Chest, Shoulders", injury: "Wrist Fracture", setsReps: "3x15", phase: "Early Rehab", description: "Reduces weight-bearing load on the wrist while maintaining chest strength." },
            { id: 11, name: "Hamstring Curls (Banded/Slider)", category: "Strength Training", focus: "Hamstrings", injury: "Hamstring Strain", setsReps: "3x12", phase: "Mid Rehab", description: "Focus on eccentric control. Keep hips stable." },
            { id: 12, name: "Triceps Extension (Band)", category: "Strength Training", focus: "Triceps", injury: "Elbow Tendonitis", setsReps: "3x15", phase: "Early Rehab", description: "Light resistance for tendon loading and strengthening elbow extensors." },
            { id: 13, name: "Supine Chin Tuck with Resistance", category: "Strength Training", focus: "Deep Neck Flexors", injury: "Cervical Sprain", setsReps: "3x10s hold", phase: "Acute/Early Rehab", description: "Strengthening neck stability with light towel resistance." },
            { id: 14, name: "Terminal Knee Extension (TKE)", category: "Strength Training", focus: "VMO", injury: "Patellofemoral Pain", setsReps: "3x20", phase: "Early Rehab", description: "Uses a band around the knee to force contraction of the vastus medialis obliquus." },
            { id: 15, name: "Side Plank (Modified)", category: "Strength Training", focus: "Obliques, Core", injury: "Low Back Instability", setsReps: "3x30s/side", phase: "Mid Rehab", description: "Perform on knees to reduce leverage and build initial side core strength." },
            { id: 16, name: "Quadruped Dumbbell Kickback", category: "Strength Training", focus: "Glutes, Low Back", injury: "Sciatica", setsReps: "3x10/leg", phase: "Mid Rehab", description: "Focus on hip extension without increasing lumbar lordosis." },
            { id: 17, name: "Reverse Fly (Thera-Band)", category: "Strength Training", focus: "Posterior Deltoid", injury: "Shoulder Impingement", setsReps: "3x15", phase: "Mid Rehab", description: "Strengthening antagonist muscles to pull shoulder blades back." },
            { id: 18, name: "Wrist Extension (Light Weight)", category: "Strength Training", focus: "Wrist Extensors", injury: "Lateral Epicondylitis", setsReps: "3x15", phase: "Early Rehab", description: "Slow, controlled movements to load the wrist extensor tendons." },
            { id: 19, name: "Front Foot Elevated Split Squat", category: "Strength Training", focus: "Quads, VMO", injury: "Knee Pain", setsReps: "3x10/leg", phase: "Late Rehab", description: "Increases the demand on the front leg's quad; improves depth." },
            { id: 20, name: "Cable External Rotation (Standing)", category: "Strength Training", focus: "Infraspinatus, Teres Minor", injury: "Rotator Cuff Tear", setsReps: "3x12", phase: "Mid Rehab", description: "Strengthening external rotators for shoulder stability and overhead function." },
            { id: 21, name: "Single-Arm Chest Press (Supine)", category: "Strength Training", focus: "Chest, Core", injury: "Rib Fracture", setsReps: "3x10/arm", phase: "Mid Rehab", description: "Requires core bracing to prevent trunk rotation; use a light dumbbell." },
            { id: 22, name: "Hip Adduction Squeeze (Ball)", category: "Strength Training", focus: "Adductors", injury: "Groin Strain", setsReps: "3x15s hold", phase: "Acute/Early Rehab", description: "Isometric contraction to promote healing and strength in the groin." },
            { id: 23, name: "Wall Slides (Shoulder Flexion)", category: "Strength Training", focus: "Shoulder Flexors", injury: "Frozen Shoulder", setsReps: "3x15", phase: "Early Rehab", description: "Active-assisted range of motion exercise using a frictionless surface." },
            { id: 24, name: "Serratus Punch (Supine)", category: "Strength Training", focus: "Serratus Anterior", injury: "Scapular Winging", setsReps: "3x15", phase: "Mid Rehab", description: "Protracting the shoulder blade against gravity for scapular control." },
            { id: 25, name: "Weighted Carries (Suitcase)", category: "Strength Training", focus: "Lateral Core", injury: "Low Back Stabilization", setsReps: "3x50 steps", phase: "Late Rehab", description: "Anti-lateral flexion drill using a single, heavy weight." },
            { id: 26, name: "Ankle Eversion with Band", category: "Strength Training", focus: "Peroneals", injury: "Ankle Sprain", setsReps: "3x20", phase: "Mid Rehab", description: "Strengthens the primary stabilizers against inversion sprains." },
            { id: 27, name: "Kettlebell Swing (Reduced ROM)", category: "Strength Training", focus: "Hip Hinge, Power", injury: "General Strength", setsReps: "3x10", phase: "Late Rehab/Return to Sport", description: "Focus on hip drive; avoid using the low back." },
            { id: 28, name: "Bicep Curls (Supinated)", category: "Strength Training", focus: "Biceps", injury: "Elbow Fracture", setsReps: "3x12", phase: "Mid Rehab", description: "Controlled flexion with light resistance, monitoring elbow comfort." },
            { id: 29, name: "Psoas March (Supine with Band)", category: "Strength Training", focus: "Hip Flexors, Core", injury: "Hip Flexor Strain", setsReps: "3x20 alternating", phase: "Mid Rehab", description: "Controlled marching motion against light band resistance." },
            { id: 30, name: "Modified Deadlift (Trap Bar)", category: "Strength Training", focus: "Posterior Chain", injury: "Low Back Fusion", setsReps: "3x8", phase: "Advanced Rehab", description: "Allows for a more upright torso position, reducing shear force on the spine." },
            { id: 31, name: "Seated Knee Extension (Unloaded)", category: "Strength Training", focus: "Quadriceps", injury: "Patellofemoral Pain", setsReps: "3x15", phase: "Early Rehab", description: "Focus on full extension and VMO activation without heavy weight." },
            { id: 32, name: "Shoulder External Rotation (Dumbbell)", category: "Strength Training", focus: "Rotator Cuff", injury: "Bicep Tendonitis", setsReps: "3x12", phase: "Mid Rehab", description: "Strengthening the stabilizers with a small dumbbell, elbow tucked." },
            { id: 33, name: "Single-Leg Deadlift (Kettlebell)", category: "Strength Training", focus: "Hamstrings, Balance", injury: "General Strength", setsReps: "3x8/leg", phase: "Late Rehab", description: "Integrates posterior chain strength with unilateral balance." },
            { id: 34, name: "Wall Sits (90-degree)", category: "Strength Training", focus: "Quads, Endurance", injury: "Patellar Tendonitis", setsReps: "3x45s hold", phase: "Mid Rehab", description: "Isometric hold to build quad endurance; maintain knee alignment over feet." },
            { id: 35, name: "Band Pull-Aparts (Overhand Grip)", category: "Strength Training", focus: "Mid/Upper Back", injury: "Postural Correction", setsReps: "3x20", phase: "All Phases", description: "Opens the chest and strengthens the scapular retractors." },
            { id: 36, name: "Reverse Nordic Curls (Assisted)", category: "Strength Training", focus: "Knee Extensors", injury: "Patellar Tendonitis", setsReps: "3x8", phase: "Advanced Rehab", description: "Aggressive eccentric quad loading; use assistance (band or hands)." },
            { id: 37, name: "Tibia Dorsiflexion (Band)", category: "Strength Training", focus: "Tibialis Anterior", injury: "Shin Splints", setsReps: "3x20", phase: "Mid Rehab", description: "Strengthens the shin muscle responsible for foot clearance during gait." },
            { id: 38, name: "Hip Flexor Isometrics (High Knee)", category: "Strength Training", focus: "Hip Flexors", injury: "Groin Strain", setsReps: "3x10s hold", phase: "Early Rehab", description: "Hold knee to chest against light self-resistance." },
            { id: 39, name: "Inverted Row (Bodyweight)", category: "Strength Training", focus: "Back, Biceps", injury: "General Strength", setsReps: "3xMax Reps", phase: "Mid-Late Rehab", description: "Modifiable pull exercise; use a lower bar to decrease difficulty." },
            { id: 40, name: "Box Squat (To Depth)", category: "Strength Training", focus: "Glutes, Hips", injury: "Hip Replacement", setsReps: "3x10", phase: "Mid Rehab", description: "Ensures consistent depth and control; use a high box initially." },
            { id: 41, name: "Dynamic Side Plank with Hip Dip", category: "Strength Training", focus: "Obliques, Core", injury: "Low Back Stabilization", setsReps: "3x15/side", phase: "Late Rehab", description: "Adds dynamic movement to challenge core stabilization." },
            { id: 42, name: "Wrist Roller (Forearm)", category: "Strength Training", focus: "Forearm Flexors/Extensors", injury: "Grip Weakness", setsReps: "3 sets, roll up/down", phase: "Late Rehab", description: "Builds grip strength and endurance in the forearms." },
            { id: 43, name: "Single-Arm Cable Fly (Chest)", category: "Strength Training", focus: "Pectorals", injury: "Shoulder Stability", setsReps: "3x12/arm", phase: "Mid-Late Rehab", description: "Unilateral chest work to correct strength imbalances." },
            { id: 44, name: "Straight Leg Raise (Supine)", category: "Strength Training", focus: "Quads, Hip Flexors", injury: "Knee Immobilization", setsReps: "3x15", phase: "Early Rehab", description: "Maintains quadriceps strength when knee movement is restricted." },
            { id: 45, name: "Seated Calf Raise (Dumbbell)", category: "Strength Training", focus: "Soleus", injury: "Calf Strain", setsReps: "3x15", phase: "Mid Rehab", description: "Targets the soleus muscle, important for endurance activities." },
            { id: 46, name: "Wood Chops (Banded/Cable)", category: "Strength Training", focus: "Rotational Core", injury: "Low Back Stabilization", setsReps: "3x10/side", phase: "Late Rehab", description: "Develops core strength for rotation and anti-rotation." },
            { id: 47, name: "Lateral Band Walks (Mini Band)", category: "Strength Training", focus: "Glute Medius", injury: "Knee/Hip Pain", setsReps: "3x20 steps/side", phase: "Mid Rehab", description: "Excellent warm-up and lateral stabilizer drill." },
            { id: 48, name: "Trap Raise (Prone Y)", category: "Strength Training", focus: "Lower Trapezius", injury: "Shoulder Posture", setsReps: "3x15", phase: "Mid Rehab", description: "Isolates the key muscle for depressing and stabilizing the scapula." },
            { id: 49, name: "Dowel Rod Mobilization (Shoulder)", category: "Strength Training", focus: "ROM, Pain-Free Movement", injury: "Shoulder Surgery", setsReps: "3x10 reps", phase: "Acute/Early Rehab", description: "Passive or active-assisted motion using a stick or dowel." },
            { id: 50, name: "Reverse Hyperextension (Stability Ball)", category: "Strength Training", focus: "Glutes, Hamstrings", injury: "Low Back Pain", setsReps: "3x12", phase: "Mid Rehab", description: "Strengthening posterior chain with minimal low back compression." },

            // STRETCHING / FLEXIBILITY (Orange) - 48 Exercises
            { id: 51, name: "Pigeon Pose Modification (Pillow)", category: "Stretching/Flexibility", focus: "Hip External Rotators", injury: "Piriformis Syndrome", setsReps: "2x60s", phase: "Chronic Pain", description: "Deep stretch for glutes and piriformis. Use a pillow for support." },
            { id: 52, name: "Wall Chest Stretch (Corner)", category: "Stretching/Flexibility", focus: "Pectorals", injury: "Round Shoulders", setsReps: "2x45s", phase: "Postural Correction", description: "Opens up the chest and counters desk posture. Keep elbows below shoulder level." },
            { id: 53, name: "Hamstring Stretch (Strap Assisted)", category: "Stretching/Flexibility", focus: "Hamstrings", injury: "Sciatica", setsReps: "3x30s", phase: "Pain Management", description: "Lie supine and use a strap to gently pull the leg towards the chest." },
            { id: 54, name: "Dynamic Thoracic Extension (Foam Roller)", category: "Stretching/Flexibility", focus: "Upper Back", injury: "Stiffness", setsReps: "10 reps", phase: "Warm-up", description: "Mobilizes the mid-back spine. Move slowly over the roller." },
            { id: 55, name: "Ankle Mobility (Wall Drill)", category: "Stretching/Flexibility", focus: "Ankle Dorsiflexion", injury: "Ankle Sprain, Plantar Fasciitis", setsReps: "3x15", phase: "Early Rehab", description: "Knee-to-wall movement to improve ankle range of motion." },
            { id: 56, name: "Nerve Glide (Slump Test Position)", category: "Stretching/Flexibility", focus: "Sciatic Nerve", injury: "Radiculopathy", setsReps: "10-20 reps", phase: "Nerve Health", description: "Gentle nerve flossing motion. Do not hold a sustained stretch." },
            { id: 57, name: "Quadriceps Stretch (Standing Assisted)", category: "Stretching/Flexibility", focus: "Quads, Hip Flexors", injury: "Knee Pain", setsReps: "3x30s/leg", phase: "Mid Rehab", description: "Standing, pull foot towards glute. Use a wall for balance." },
            { id: 58, name: "Cat-Cow Dynamic Stretch", category: "Stretching/Flexibility", focus: "Spinal Mobility", injury: "General Back Stiffness", setsReps: "3x10 reps", phase: "Warm-up", description: "Flowing movement to articulate the spine gently." },
            { id: 59, name: "Child's Pose (Wide Knee)", category: "Stretching/Flexibility", focus: "Lower Back, Hips", injury: "General Relaxation", setsReps: "2x60s", phase: "Cool-down", description: "Restorative stretch to decompress the low back." },
            { id: 60, name: "Figure-Four Stretch (Supine)", category: "Stretching/Flexibility", focus: "Glutes, Hip Capsule", injury: "Hip Bursitis", setsReps: "3x45s/side", phase: "Chronic Pain", description: "Cross ankle over opposite knee; pull knee towards chest." },
            { id: 61, name: "Side-Lying Quad Stretch (TFL Focus)", category: "Stretching/Flexibility", focus: "TFL, Hip Flexors", injury: "IT Band Syndrome", setsReps: "3x45s/side", phase: "Mid Rehab", description: "Focus on pulling the knee back while maintaining a neutral pelvis." },
            { id: 62, name: "Wrist Flexor Stretch (Palm Down)", category: "Stretching/Flexibility", focus: "Forearm Flexors", injury: "Medial Epicondylitis", setsReps: "3x30s/arm", phase: "Acute/Early Rehab", description: "Gentle pull on fingers to stretch the inner forearm muscles." },
            { id: 63, name: "Dynamic Arm Circles (Forward/Back)", category: "Stretching/Flexibility", focus: "Shoulder Mobility", injury: "Shoulder Stiffness", setsReps: "2x20 reps/direction", phase: "Warm-up", description: "Small, controlled circles progressing to larger range of motion." },
            { id: 64, name: "Calf Stretch (Gastrocnemius, Straight Knee)", category: "Stretching/Flexibility", focus: "Calf", injury: "Plantar Fasciitis", setsReps: "3x45s/leg", phase: "Chronic Pain", description: "Lean into a wall with the back leg straight, heel on the floor." },
            { id: 65, name: "Calf Stretch (Soleus, Bent Knee)", category: "Stretching/Flexibility", focus: "Calf", injury: "Achilles Tendinopathy", setsReps: "3x45s/leg", phase: "Chronic Pain", description: "Bend the back knee slightly to target the deeper soleus muscle." },
            { id: 66, name: "Triceps Stretch (Overhead Pull)", category: "Stretching/Flexibility", focus: "Triceps, Lats", injury: "General Upper Body", setsReps: "2x30s/arm", phase: "Cool-down", description: "Pull elbow behind the head; gentle stretch down the back of the arm." },
            { id: 67, name: "Spinal Twist (Supine)", category: "Stretching/Flexibility", focus: "Spinal Rotation", injury: "Thoracic Mobility", setsReps: "2x60s/side", phase: "General Mobility", description: "Lie on back, cross one leg over; keep shoulders flat." },
            { id: 68, name: "Seated Good Morning (Light)", category: "Stretching/Flexibility", focus: "Hamstrings, Low Back", injury: "Low Back Stiffness", setsReps: "3x10 reps", phase: "Warm-up", description: "Gentle hip hinge to stretch the back of the legs." },
            { id: 69, name: "Iliopsoas Stretch (Kneeling Lunge)", category: "Stretching/Flexibility", focus: "Hip Flexors", injury: "Anterior Hip Pain", setsReps: "3x45s/leg", phase: "Mid Rehab", description: "Push hips forward gently in a kneeling lunge position." },
            { id: 70, name: "Thread the Needle (Shoulder/Upper Back)", category: "Stretching/Flexibility", focus: "Thoracic Rotation", injury: "Shoulder Impingement", setsReps: "3x45s/side", phase: "Mobility", description: "Thread one arm under the other while in quadruped." },
            { id: 71, name: "Dynamic Knee-to-Chest (Alternating)", category: "Stretching/Flexibility", focus: "Low Back, Hips", injury: "Warm-up", setsReps: "2x10 reps/side", phase: "Warm-up", description: "Gentle rocking motion to loosen the low back and hips before activity." },
            { id: 72, name: "Cervical Lateral Flexion Stretch (Hand Assist)", category: "Stretching/Flexibility", focus: "Upper Trapezius", injury: "Neck Tension", setsReps: "3x30s/side", phase: "Pain Management", description: "Gently pull head to the side; look forward." },
            { id: 73, name: "Posterior Capsule Stretch (Sleeper)", category: "Stretching/Flexibility", focus: "Shoulder Internal Rotators", injury: "Shoulder Impingement", setsReps: "3x45s/side", phase: "Mid Rehab", description: "Lying on side, gently press forearm down towards the floor." },
            { id: 74, name: "Pectoralis Minor Stretch (Doorway)", category: "Stretching/Flexibility", focus: "Pectoralis Minor", injury: "Postural Correction", setsReps: "2x60s", phase: "Postural Correction", description: "Standing in a doorway with arms raised to 90 degrees." },
            { id: 75, name: "Standing TFL/IT Band Stretch (Crossed Legs)", category: "Stretching/Flexibility", focus: "IT Band, TFL", injury: "IT Band Syndrome", setsReps: "3x45s/side", phase: "Chronic Pain", description: "Cross one leg behind the other and lean away from the side being stretched." },
            { id: 76, name: "Active Straight Leg Raise (ASLR)", category: "Stretching/Flexibility", focus: "Hip Flexors, Hamstrings", injury: "Sciatica", setsReps: "3x10/leg", phase: "Mobility", description: "Supine, actively lift leg while maintaining a flat low back." },
            { id: 77, name: "Dynamic Butt Kicks (Standing)", category: "Stretching/Flexibility", focus: "Quadriceps, Warm-up", injury: "Warm-up", setsReps: "2x30s", phase: "Warm-up", description: "Light jogging motion bringing heels to glutes." },
            { id: 78, name: "Dynamic Frankenstein Walks", category: "Stretching/Flexibility", focus: "Hamstrings, Hip Flexors", injury: "Warm-up", setsReps: "2x20 steps", phase: "Warm-up", description: "Straight-leg marching, trying to touch opposite hand to foot." },
            { id: 79, name: "Wall Assisted Hip Extension Stretch", category: "Stretching/Flexibility", focus: "Hip Flexors", injury: "Swayback Posture", setsReps: "3x45s/side", phase: "Postural Correction", description: "Prone, one leg hangs off table/bed to achieve gravity-assisted extension." },
            { id: 80, name: "Median Nerve Glide (Wrist Extension)", category: "Stretching/Flexibility", focus: "Nerve Mobility", injury: "Carpal Tunnel", setsReps: "3x10 reps", phase: "Nerve Health", description: "Gentle flossing of the median nerve from the neck to the wrist." },
            { id: 81, name: "Ulnar Nerve Glide (OK Sign)", category: "Stretching/Flexibility", focus: "Nerve Mobility", injury: "Cubital Tunnel", setsReps: "3x10 reps", phase: "Nerve Health", description: "Forming the 'OK' sign over the eye socket." },
            { id: 82, name: "Radial Nerve Glide (Waiter's Tip)", category: "Stretching/Flexibility", focus: "Nerve Mobility", injury: "General Arm Pain", setsReps: "3x10 reps", phase: "Nerve Health", description: "Positioning the arm like a waiter carrying a tray." },
            { id: 83, name: "Ankle Alphabet", category: "Stretching/Flexibility", focus: "Ankle ROM", injury: "Ankle Sprain", setsReps: "2x Full Alphabet/ankle", phase: "Acute/Early Rehab", description: "Tracing the alphabet with the big toe to promote controlled motion." },
            { id: 84, name: "Adductor Stretch (Seated Straddle)", category: "Stretching/Flexibility", focus: "Inner Thigh", injury: "Groin Strain", setsReps: "3x45s", phase: "Mid Rehab", description: "Seated with legs wide, lean forward or to the side." },
            { id: 85, name: "Psoas PNF Contract-Relax", category: "Stretching/Flexibility", focus: "Hip Flexors", injury: "Hip Tightness", setsReps: "3 reps of 10s hold", phase: "Advanced Mobility", description: "Active contraction followed by a deeper passive stretch." },
            { id: 86, name: "Wall Assisted Pec Major Stretch (90-90)", category: "Stretching/Flexibility", focus: "Pectoralis Major", injury: "Shoulder Surgery", setsReps: "3x45s/side", phase: "Mid Rehab", description: "Arm in a 90/90 position against a door frame." },
            { id: 87, name: "Dynamic Hamstring Swoops (Standing)", category: "Stretching/Flexibility", focus: "Hamstrings", injury: "Warm-up", setsReps: "2x10 reps/side", phase: "Warm-up", description: "Standing, bending and straightening the leg while reaching toward the floor." },
            { id: 88, name: "Seated Upper Trap Stretch (Look Down)", category: "Stretching/Flexibility", focus: "Upper Trapezius", injury: "Cervicogenic Headache", setsReps: "3x30s/side", phase: "Pain Management", description: "Sit, pull head gently to side, then look down toward the opposite hip." },
            { id: 89, name: "Posterior Shoulder Stretch (Cross-Body)", category: "Stretching/Flexibility", focus: "Deltoid, Capsule", injury: "Shoulder Impingement", setsReps: "3x30s/arm", phase: "General Mobility", description: "Pull arm across the body toward the opposite shoulder." },
            { id: 90, name: "Hip External Rotation (Butterfly)", category: "Stretching/Flexibility", focus: "Hip External Rotators", injury: "Hip OA", setsReps: "2x60s", phase: "General Mobility", description: "Seated, soles of feet together, gently press knees down." },
            { id: 91, name: "Kneeling Hip Flexor with Trunk Rotation", category: "Stretching/Flexibility", focus: "Hip Flexors, T-Spine", injury: "Low Back Stiffness", setsReps: "3x10 reps/side", phase: "Mobility", description: "Adds a dynamic twist to the hip flexor stretch." },
            { id: 92, name: "Lattissimus Dorsi Stretch (Overhead Doorway)", category: "Stretching/Flexibility", focus: "Lats", injury: "Shoulder Mobility", setsReps: "3x45s/side", phase: "General Mobility", description: "Reach overhead and grip the side of a door frame; lean away." },
            { id: 93, name: "Side Bend (Standing)", category: "Stretching/Flexibility", focus: "QL, Obliques", injury: "Low Back Stiffness", setsReps: "3x10/side", phase: "Warm-up", description: "Reach one arm overhead and gently lean to the side." },
            { id: 94, name: "Wrist Extension Stretch (Palm Down)", category: "Stretching/Flexibility", focus: "Forearm Extensors", injury: "Lateral Epicondylitis", setsReps: "3x30s/arm", phase: "Acute/Early Rehab", description: "Gently pull hand downward while arm is straight." },
            { id: 95, name: "Towel Scoop Stretch (Shoulder ER)", category: "Stretching/Flexibility", focus: "Shoulder External Rotation", injury: "Shoulder Stiffness", setsReps: "3x10 reps", phase: "Early Rehab", description: "Use a towel behind the back to gently pull the affected arm into external rotation." },
            { id: 96, name: "Quadruped Hip Circles", category: "Stretching/Flexibility", focus: "Hip Mobility", injury: "Hip OA", setsReps: "2x10 clockwise/counter-clockwise", phase: "Warm-up", description: "Large, controlled circles with the hip while on hands and knees." },
            { id: 97, name: "Heel Raises (Off Step, Eccentric Focus)", category: "Stretching/Flexibility", focus: "Achilles Tendon", injury: "Achilles Tendinopathy", setsReps: "3x12 (slow lower)", phase: "Mid-Late Rehab", description: "Controlled lowering phase to promote tendon repair." },
            { id: 98, name: "Lying Side-to-Side Knee Rolls", category: "Stretching/Flexibility", focus: "Low Back, Hips", injury: "Lumbar Stiffness", setsReps: "3x10 rolls", phase: "General Mobility", description: "Supine, knees bent, gently let knees fall to the side." },

            // BALANCE / COORDINATION (Teal) - 45 Exercises
            { id: 101, name: "Single-Leg Stance (Eyes Closed)", category: "Balance/Coordination", focus: "Proprioception", injury: "Ankle/Knee", setsReps: "3x30s/leg", phase: "Late Rehab/Return to Sport", description: "Removes visual input to challenge the vestibular and somatosensory systems." },
            { id: 102, name: "Tandem Stance (Heel-to-Toe)", category: "Balance/Coordination", focus: "Static Balance", injury: "Vestibular", setsReps: "3x60s", phase: "Balance Training", description: "Progress from wide base to full heel-to-toe stance." },
            { id: 103, name: "Weight Shifting (AP/ML)", category: "Balance/Coordination", focus: "Dynamic Stability", injury: "Hip/Knee", setsReps: "3x2 minutes", phase: "Mid Rehab", description: "Controlled shifts of center of gravity forward/back (AP) and side/side (ML)." },
            { id: 104, name: "BAPS Board Training (Clock)", category: "Balance/Coordination", focus: "Ankle Stability", injury: "Ankle Instability", setsReps: "3x1 minute", phase: "Late Rehab", description: "Tracing a figure-8 or clock pattern to recruit smaller stabilizing muscles." },
            { id: 105, name: "Head Turns in Single-Leg Stance", category: "Balance/Coordination", focus: "Vestibular/Ocular Motor", injury: "Concussion, Dizziness", setsReps: "3x10/side", phase: "Advanced Rehab", description: "Maintains stability while challenging the inner ear and vision systems." },
            { id: 106, name: "Single-Leg Stance (Pillow Surface)", category: "Balance/Coordination", focus: "Proprioception, Ankle", injury: "Ankle Sprain", setsReps: "3x30s/leg", phase: "Mid Rehab", description: "Introduces an unstable surface to challenge lower leg and foot stabilizers." },
            { id: 107, name: "Single-Leg Squat (To Chair)", category: "Balance/Coordination", focus: "Unilateral Strength, Stability", injury: "Knee Surgery", setsReps: "3x10/leg", phase: "Late Rehab", description: "Develops strength and balance concurrently. Tap the chair lightly." },
            { id: 108, name: "Star Excursion Balance Test (SEBT)", category: "Balance/Coordination", focus: "Dynamic Reach", injury: "Ankle/Knee", setsReps: "3x5 reaches/direction", phase: "Late Rehab/Pre-Sport", description: "Standing on one leg, reaching in multiple directions." },
            { id: 109, name: "Tandem Walk (Heel-to-Toe, Forward)", category: "Balance/Coordination", focus: "Gait Stability", injury: "Neuropathy", setsReps: "3x10 steps", phase: "Balance Training", description: "Focus on slow, deliberate steps in a straight line." },
            { id: 110, name: "Tandem Walk (Backward)", category: "Balance/Coordination", focus: "Dynamic Stability", injury: "Fall Risk", setsReps: "3x10 steps", phase: "Balance Training", description: "Walking backward in a heel-to-toe line for increased challenge." },
            { id: 111, name: "Walking on Uneven Surface (Mat)", category: "Balance/Coordination", focus: "Gait, Foot Stability", injury: "Foot Surgery", setsReps: "3x2 minutes", phase: "Mid-Late Rehab", description: "Challenges the foot and ankle stabilizers on a soft surface." },
            { id: 112, name: "Catch/Throw with Single-Leg Stance", category: "Balance/Coordination", focus: "Dual Tasking, Reaction", injury: "Concussion, Fall Risk", setsReps: "3x1 minute", phase: "Advanced Rehab", description: "Adds a cognitive/reactionary challenge to static balance." },
            { id: 113, name: "Head Nods (Up/Down) in Tandem Stance", category: "Balance/Coordination", focus: "Vestibular Input", injury: "Dizziness", setsReps: "3x10 reps", phase: "Advanced Rehab", description: "Moving the head while maintaining a difficult foot position." },
            { id: 114, name: "Walking with Visual Cues (Floor Tape)", category: "Balance/Coordination", focus: "Gait Deviation", injury: "Parkinson's Disease", setsReps: "3x5 minutes", phase: "Gait Training", description: "Uses external visual targets to facilitate better step patterns." },
            { id: 115, name: "Single-Leg Stance with Ball Toss", category: "Balance/Coordination", focus: "Core Stability, Balance", injury: "Low Back Pain", setsReps: "3x1 minute/side", phase: "Mid-Late Rehab", description: "Anti-rotational challenge while standing on one leg." },
            { id: 116, name: "Lunges on Foam Pad", category: "Balance/Coordination", focus: "Dynamic Unstable Surface", injury: "Knee/Hip", setsReps: "3x10/leg", phase: "Late Rehab", description: "Combines strength with extreme balance challenge." },
            { id: 117, name: "Step and Reach (Low Step)", category: "Balance/Coordination", focus: "Controlled Descent", injury: "Knee Pain", setsReps: "3x12/leg", phase: "Mid Rehab", description: "Focus on slow, controlled stepping down off a small box." },
            { id: 118, name: "Clock Reach (Modified SEBT)", category: "Balance/Coordination", focus: "Hip Strategy", injury: "Hip Replacement", setsReps: "3x8 reaches/leg", phase: "Mid Rehab", description: "Simpler version of SEBT, only reaching to 12, 3, 6, 9 o'clock." },
            { id: 119, name: "Single-Leg RDL (Unweighted)", category: "Balance/Coordination", focus: "Proprioception, Hip Hinge", injury: "Hamstring Strain", setsReps: "3x10/leg", phase: "Mid Rehab", description: "Focus on form and balance, maintaining a neutral spine." },
            { id: 120, name: "BOSU Ball Squats (Assisted)", category: "Balance/Coordination", focus: "Ankle/Knee Stability", injury: "General Fall Risk", setsReps: "3x10", phase: "Mid Rehab", description: "Semi-unstable surface squat; use a railing for assistance." },
            { id: 121, name: "Vestibular Habituation (Gaze Stabilization)", category: "Balance/Coordination", focus: "Inner Ear Function", injury: "Vestibular Hypofunction", setsReps: "3x1 minute", phase: "Vestibular Rehab", description: "Keeping eyes fixed on a target while moving the head side-to-side." },
            { id: 122, name: "Weight Shifting with Arm Reach (Forward)", category: "Balance/Coordination", focus: "Limits of Stability", injury: "General Balance", setsReps: "3x15", phase: "Mid Rehab", description: "Reaching forward while maintaining balance, testing postural sway." },
            { id: 123, name: "Walk with Head Turns (Slow)", category: "Balance/Coordination", focus: "Gait, Dual Task", injury: "Concussion", setsReps: "3x5 minutes", phase: "Mid-Late Rehab", description: "Slow walking while actively turning the head left/right with each step." },
            { id: 124, name: "Single-Leg Jump & Stick (Forward)", category: "Balance/Coordination", focus: "Plyometrics, Landing", injury: "Return to Sport (Knee)", setsReps: "3x8 jumps/leg", phase: "Advanced Rehab", description: "Explosive jump followed by a static hold upon landing." },
            { id: 125, name: "Agility Ladder Drills (2 Feet In)", category: "Balance/Coordination", focus: "Foot Speed, Coordination", injury: "Ankle Sprain", setsReps: "3x5 passes", phase: "Advanced Rehab", description: "Focus on quick, light foot contact and minimal visual focus." },
            { id: 126, name: "Figure-Eight Walking", category: "Balance/Coordination", focus: "Dynamic Turning", injury: "Fall Risk", setsReps: "3x5 minutes", phase: "Gait Training", description: "Walking in a controlled, curved path to practice turning stability." },
            { id: 127, name: "Single-Leg Stance (Mini Trampoline)", category: "Balance/Coordination", focus: "High Instability", injury: "Ankle/Knee", setsReps: "3x20s/leg", phase: "Advanced Rehab", description: "Very challenging surface; use nearby support for safety." },
            { id: 128, name: "Standing March (Eyes Closed)", category: "Balance/Coordination", focus: "Proprioception", injury: "Neuropathy", setsReps: "3x30s", phase: "Balance Training", description: "Marching in place without visual feedback." },
            { id: 129, name: "Tandem Stance (Visual Conflict)", category: "Balance/Coordination", focus: "Sensory Integration", injury: "Dizziness", setsReps: "3x45s", phase: "Vestibular Rehab", description: "Stand in tandem while watching a busy, scrolling video screen." },
            { id: 130, name: "Single-Leg Hop to Stability", category: "Balance/Coordination", focus: "Landing Mechanics", injury: "Knee Surgery", setsReps: "3x10 hops", phase: "Advanced Rehab", description: "Short, quick hop followed by a 3-second stable landing hold." },
            { id: 131, name: "Four-Square Stepping (Coordination)", category: "Balance/Coordination", focus: "Footwork, Coordination", injury: "Gait Dysfunction", setsReps: "3x1 minute", phase: "Mid Rehab", description: "Stepping into patterned squares on the floor." },
            { id: 132, name: "Weight Shifting (Lateral with Band)", category: "Balance/Coordination", focus: "Anti-adduction Stability", injury: "Hip Weakness", setsReps: "3x1 minute", phase: "Mid Rehab", description: "Band pulls the body inward; resist while shifting weight laterally." },
            { id: 133, name: "Foam Roll Single-Leg Balance (Ankle)", category: "Balance/Coordination", focus: "Ankle Stabilization", injury: "Ankle Sprain", setsReps: "3x30s/leg", phase: "Late Rehab", description: "Standing on the curved top of a foam roll (longitudinally)." },
            { id: 134, name: "Walking with Varying Speeds", category: "Balance/Coordination", focus: "Gait Modulation", injury: "Gait Training", setsReps: "3x5 minutes", phase: "Gait Training", description: "Alternating between slow, medium, and fast walking pace." },
            { id: 135, name: "Reaction Step (Visual Cue)", category: "Balance/Coordination", focus: "Reaction Time, Fall Prevention", injury: "Fall Risk", setsReps: "3x2 minutes", phase: "Advanced Rehab", description: "Stepping quickly when a light or colored card is presented." },
            { id: 136, name: "Walking Over Obstacles (Low)", category: "Balance/Coordination", focus: "Gait Clearance", injury: "Foot Drop", setsReps: "3x10 passes", phase: "Mid-Late Rehab", description: "Step over small cones or dowels to practice foot clearance." },
            { id: 137, name: "Single-Leg Stance (Throwing Weighted Ball)", category: "Balance/Coordination", focus: "Trunk Stability, Power", injury: "Shoulder Surgery", setsReps: "3x10 throws/side", phase: "Advanced Rehab", description: "Throwing a light medicine ball against a wall while balancing." },
            { id: 138, name: "Marching on BOSU Ball (Dome Side Up)", category: "Balance/Coordination", focus: "Dynamic Ankle", injury: "Ankle Instability", setsReps: "3x1 minute", phase: "Mid-Late Rehab", description: "Marching in place on the unstable surface." },
            { id: 139, name: "Standing with Reduced Base of Support (Feet Together)", category: "Balance/Coordination", focus: "Static Balance", injury: "General Fall Risk", setsReps: "3x60s", phase: "Early-Mid Rehab", description: "Stand with feet touching side-by-side." },
            { id: 140, name: "Walking with Dual Task (Counting Backwards)", category: "Balance/Coordination", focus: "Cognitive/Motor Integration", injury: "Concussion, Fall Risk", setsReps: "3x5 minutes", phase: "Advanced Rehab", description: "Walk while performing a simple math task." },
            { id: 141, name: "Single-Leg Squat (Band Around Knees)", category: "Balance/Coordination", focus: "Knee Tracking", injury: "Patellofemoral Pain", setsReps: "3x10/leg", phase: "Late Rehab", description: "Band forces hip abductor engagement to control knee alignment." },
            { id: 142, name: "Wobble Board Squats (Assisted)", category: "Balance/Coordination", focus: "Ankle/Knee Stability", injury: "Ankle Sprain", setsReps: "3x10", phase: "Late Rehab", description: "Squatting motion on a board that tilts in all directions." },
            { id: 143, name: "Lateral Shuffles (Mini-Band)", category: "Balance/Coordination", focus: "Dynamic Lateral Stability", injury: "Knee/Hip", setsReps: "3x10 steps/side", phase: "Late Rehab/Pre-Sport", description: "Quick side-steps while maintaining tension on the band." },
            { id: 144, name: "Walking on Heels (Forward)", category: "Balance/Coordination", focus: "Dorsiflexion, Balance", injury: "Gait Training", setsReps: "3x30 steps", phase: "Mid Rehab", description: "Walk only on heels, challenging the dorsiflexors and balance." },
            { id: 145, name: "Walking on Toes (Forward)", category: "Balance/Coordination", focus: "Plantarflexion, Balance", injury: "Calf Endurance", setsReps: "3x30 steps", phase: "Mid Rehab", description: "Walk only on toes to challenge calf endurance and ankle stability." },

            // FUNCTIONAL EXERCISES (Indigo) - 45 Exercises
            { id: 151, name: "Sit-to-Stand (No Arms)", category: "Functional Exercise", focus: "Daily Living", injury: "General Weakness", setsReps: "3x15", phase: "All Phases", description: "Mimics a critical daily activity. Use a higher chair initially." },
            { id: 152, name: "Farmer's Carry (Single-Sided)", category: "Functional Exercise", focus: "Grip, Core Stability", injury: "Low Back Pain", setsReps: "3x30 steps", phase: "Late Rehab/Pre-Sport", description: "Anti-lateral flexion drill. Focus on maintaining level shoulders and hips." },
            { id: 153, name: "Stair Climbs (Focusing on Foot Placement)", category: "Functional Exercise", focus: "Gait, Quads", injury: "Knee Surgery", setsReps: "3 sets of 1 flight", phase: "Mid-Late Rehab", description: "Practice a slow, deliberate ascent/descent focusing on knee tracking." },
            { id: 154, name: "Basket-Reach and Return", category: "Functional Exercise", focus: "Trunk Rotation", injury: "Low Back Disc", setsReps: "3x10", phase: "Late Rehab", description: "Controlled rotation from the core. Keep feet stationary, pivot through hips/trunk." },
            { id: 155, name: "Weighted Lunge (Reverse)", category: "Functional Exercise", focus: "Unilateral Strength", injury: "General Strength", setsReps: "3x10/leg", phase: "Late Rehab", description: "Easier on the knee than a forward lunge; excellent for posterior chain loading." },
            { id: 156, name: "Treadmill Walking (Backward)", category: "Functional Exercise", focus: "Gait, Knee Tracking", injury: "Patellofemoral Pain", setsReps: "3x5 minutes", phase: "Mid Rehab", description: "Reduces weight-bearing load on the knee while strengthening quads. Use handrails." },
            { id: 157, name: "Carrying a Basket (Loaded)", category: "Functional Exercise", focus: "Grip, Postural Endurance", injury: "Postural Syndrome", setsReps: "3x2 minutes", phase: "Late Rehab", description: "Carry a weighted basket/box; focus on shoulder retraction and upright posture." },
            { id: 158, name: "Simulated Gardening (Bending/Reaching)", category: "Functional Exercise", focus: "Hip Hinge, Squat", injury: "Low Back Pain", setsReps: "3x10 cycles", phase: "Mid-Late Rehab", description: "Practice safe lifting and bending motions typical of yard work." },
            { id: 159, name: "Putting Away Dishes (Overhead Reach)", category: "Functional Exercise", focus: "Shoulder Endurance, ROM", injury: "Shoulder Impingement", setsReps: "3x10 reps", phase: "Mid Rehab", description: "Controlled lifting and placing of light objects onto a high shelf." },
            { id: 160, name: "Getting In/Out of a Car Simulation", category: "Functional Exercise", focus: "Trunk/Hip Rotation", injury: "Hip Replacement", setsReps: "3x5 reps/side", phase: "Mid Rehab", description: "Practice the pivot and sit motion safely." },
            { id: 161, name: "Opening Heavy Door (Resistance)", category: "Functional Exercise", focus: "Push/Pull Strength", injury: "Elbow Tendonitis", setsReps: "3x10 reps", phase: "Late Rehab", description: "Use a band attached to a door handle to simulate a heavy pull." },
            { id: 162, name: "Squat to Pick Up Object (Controlled)", category: "Functional Exercise", focus: "Lifting Mechanics", injury: "Low Back Disc", setsReps: "3x15", phase: "Mid Rehab", description: "Focus on maintaining a straight back and driving through the hips." },
            { id: 163, name: "Throwing Motion (Light Ball)", category: "Functional Exercise", focus: "Shoulder Power, Core", injury: "Rotator Cuff Repair", setsReps: "3x10 reps", phase: "Advanced Rehab", description: "Gradual progression from short, slow throws to longer, faster ones." },
            { id: 164, name: "Walking with Head Turns (Functional Task)", category: "Functional Exercise", focus: "Gait, Safety", injury: "Concussion, Fall Risk", setsReps: "3x5 minutes", phase: "Late Rehab", description: "Walking while actively scanning the environment (e.g., looking for keys)." },
            { id: 165, name: "Unilateral Step Down (Controlled)", category: "Functional Exercise", focus: "Knee Eccentric Control", injury: "Patellofemoral Pain", setsReps: "3x10/leg", phase: "Mid Rehab", description: "Standing on a step, slowly lower the other heel to the floor." },
            { id: 166, name: "Laundry Basket Carry (Stairs)", category: "Functional Exercise", focus: "Grip, Stair Climbing", injury: "General Strength", setsReps: "3x1 flight", phase: "Late Rehab", description: "Practice carrying weight up and down stairs safely." },
            { id: 167, name: "Lateral Step Overs (Cone)", category: "Functional Exercise", focus: "Hip Clearance, Agility", injury: "Ankle Sprain", setsReps: "3x10/side", phase: "Late Rehab/Pre-Sport", description: "Stepping sideways over a low obstacle." },
            { id: 168, name: "Vacuuming Simulation (Band Resistance)", category: "Functional Exercise", focus: "Core/Shoulder Endurance", injury: "Low Back/Shoulder", setsReps: "3x1 minute/side", phase: "Mid Rehab", description: "Use a band attached to a stable object to resist the forward/back motion." },
            { id: 169, name: "Donning a Backpack (Weighted)", category: "Functional Exercise", focus: "Shoulder Coordination", injury: "Shoulder Surgery", setsReps: "3x5 reps", phase: "Mid-Late Rehab", description: "Practice the motion of slipping on a light backpack safely." },
            { id: 170, name: "Carrying a Child Simulation (Unilateral Hold)", category: "Functional Exercise", focus: "Side Core Endurance", injury: "Low Back Pain", setsReps: "3x30s hold/side", phase: "Late Rehab", description: "Holding a light weight off to one side to simulate carrying a child." },
            { id: 171, name: "Standing on Toes (Reaching for Object)", category: "Functional Exercise", focus: "Ankle/Calf Power", injury: "Fall Risk", setsReps: "3x10 reps", phase: "Mid Rehab", description: "Combining heel raise with an overhead reach." },
            { id: 172, name: "Pushing a Cart Simulation (Wall)", category: "Functional Exercise", focus: "Chest/Shoulder Push", injury: "Shoulder Surgery", setsReps: "3x10s push", phase: "Early Rehab", description: "Isometric push against a wall to rebuild pushing strength." },
            { id: 173, name: "Jumping Jacks (Modified/Low Impact)", category: "Functional Exercise", focus: "Cardio, Coordination", injury: "Knee/Ankle", setsReps: "3x30 seconds", phase: "Mid-Late Rehab", description: "Step-out jacks or low-impact jumping for cardiovascular fitness." },
            { id: 174, name: "Picking Up Small Objects (Toes)", category: "Functional Exercise", focus: "Foot/Toe Dexterity", injury: "Foot Pain", setsReps: "3x1 minute", phase: "Mid Rehab", description: "Using toes to pick up marbles or a towel." },
            { id: 175, name: "Single-Leg Balance (Closing a Drawer)", category: "Functional Exercise", focus: "Balance with Reach", injury: "Fall Risk", setsReps: "3x10/leg", phase: "Mid Rehab", description: "Stand on one leg while performing a small, controlled reach/pull motion." },
            { id: 176, name: "Getting Off the Floor (Pattern)", category: "Functional Exercise", focus: "Mobility, Strength", injury: "General Weakness", setsReps: "3x5 reps", phase: "All Phases", description: "Practice safely transitioning from floor to standing." },
            { id: 177, name: "Carrying Groceries (Alternating Hands)", category: "Functional Exercise", focus: "Grip, Postural Control", injury: "Core Stability", setsReps: "3x1 minute", phase: "Late Rehab", description: "Walking while shifting a light load from one hand to the other." },
            { id: 178, name: "Broom/Mop Simulation (Rotation)", category: "Functional Exercise", focus: "Trunk Rotation, Arms", injury: "Low Back", setsReps: "3x1 minute", phase: "Mid Rehab", description: "Controlled twisting motions typical of sweeping or mopping." },
            { id: 179, name: "Lawn Mower Pull (Band)", category: "Functional Exercise", focus: "Pull Strength, Core", injury: "Low Back/Shoulder", setsReps: "3x10/side", phase: "Late Rehab", description: "Simulates pulling a cord or pushing a heavy object with resistance." },
            { id: 180, name: "Unpacking a Box (Floor to Table)", category: "Functional Exercise", focus: "Lifting Pattern", injury: "Low Back", setsReps: "3x10 reps", phase: "Mid Rehab", description: "Practice safe lifting of a moderate weight from a low surface to a high surface." },

            // MOTOR CONTROL (Deep Green) - 45 Exercises
            { id: 201, name: "Diaphragmatic Breathing (Supine)", category: "Motor Control", focus: "Core Activation", injury: "Post-op, Chronic Pain", setsReps: "5 minutes", phase: "Acute/Early Rehab", description: "Learning to use the diaphragm for proper bracing and core stability. Belly rises." },
            { id: 202, name: "Cervical Retraction (Chin Tuck)", category: "Motor Control", focus: "Deep Neck Flexors", injury: "Whiplash, Headaches", setsReps: "3x10 reps", phase: "Postural Correction", description: "Strengthening small stabilizing muscles in the neck. Do not overuse accessory muscles." },
            { id: 203, name: "Transversus Abdominis Activation (Hollowing)", category: "Motor Control", focus: "Deep Core", injury: "Low Back Instability", setsReps: "3x10s hold", phase: "Early Rehab", description: "Draw naval slightly toward spine without moving pelvis or breathing in chest." },
            { id: 204, name: "Foot Intrinsic Muscle Short Arc", category: "Motor Control", focus: "Arch Stability", injury: "Plantar Fasciitis", setsReps: "3x15", phase: "Early Rehab", description: "Practice 'short-foot' exercise to activate the arch muscles. No toe curling." },
            { id: 205, name: "Pelvic Tilt (Anterior/Posterior)", category: "Motor Control", focus: "Lumbar/Pelvic Awareness", injury: "Low Back Pain", setsReps: "3x10", phase: "Acute/Early Rehab", description: "Gentle movement to improve body awareness and segment isolation in the low back." },
            { id: 206, name: "Hip Hike (Standing)", category: "Motor Control", focus: "Gluteal Firing", injury: "Trendelenburg Gait", setsReps: "3x15/leg", phase: "Mid Rehab", description: "Lifts the non-weight bearing hip using the stance leg's gluteus medius." },
            { id: 207, name: "Quadruped Arm Lift (Without Trunk Shift)", category: "Motor Control", focus: "Core/Trunk Stability", injury: "Low Back Instability", setsReps: "3x10/arm", phase: "Mid Rehab", description: "Lift one arm while maintaining a perfectly still, level torso." },
            { id: 208, name: "Heel Slide (Supine, Core Control)", category: "Motor Control", focus: "TA/Core Activation", injury: "Low Back Pain", setsReps: "3x10/leg", phase: "Early Rehab", description: "Sliding heel along the floor while maintaining a neutral pelvis/low back." },
            { id: 209, name: "Scapular Setting (Wall)", category: "Motor Control", focus: "Scapular Control", injury: "Shoulder Impingement", setsReps: "3x10s hold", phase: "Early Rehab", description: "Practice retracting and depressing the shoulder blades against a wall." },
            { id: 210, name: "Ball Squeeze (Knee Adduction)", category: "Motor Control", focus: "Core/Adductor Synergy", injury: "Pelvic Floor Dysfunction", setsReps: "3x10s hold", phase: "Early Rehab", description: "Squeeze a small ball between the knees to engage the deep core." },
            { id: 211, name: "Standing Hip Abduction (Controlled)", category: "Motor Control", focus: "Unilateral Stability", injury: "Hip/Knee", setsReps: "3x15/leg", phase: "Mid Rehab", description: "Slow, small lift of the leg out to the side; focus on avoiding pelvic drop." },
            { id: 212, name: "Brugger Relief Position", category: "Motor Control", focus: "Postural Awareness", injury: "Chronic Pain", setsReps: "3x1 minute", phase: "Postural Correction", description: "Seated, focus on arching back, opening chest, and rotating arms externally." },
            { id: 213, name: "Pointer Dog (Quadruped Alternate Limb)", category: "Motor Control", focus: "Cross-Body Stability", injury: "Low Back Instability", setsReps: "3x10/side", phase: "Mid Rehab", description: "Extend opposite arm and leg while maintaining a flat back." },
            { id: 214, name: "Supine March (Small Arc)", category: "Motor Control", focus: "Deep Core Endurance", injury: "Low Back Pain", setsReps: "3x20 alternating", phase: "Mid Rehab", description: "Lifting knees one at a time, keeping the low back stable on the floor." },
            { id: 215, name: "Standing Heel-Toe Rocking", category: "Motor Control", focus: "Ankle Strategy", injury: "General Balance", setsReps: "3x30s", phase: "Early Balance", description: "Gently rocking forward onto toes and back onto heels." },
            { id: 216, name: "I's, T's, Y's (Prone, Bodyweight)", category: "Motor Control", focus: "Mid/Lower Trapezius", injury: "Shoulder Posture", setsReps: "3x10 reps", phase: "Mid Rehab", description: "Focus on isolating the back muscles without momentum." },
            { id: 217, name: "Supine Abdominal Bracing (Cough)", category: "Motor Control", focus: "Core Firing Pattern", injury: "Post-op Core", setsReps: "3x10 contractions", phase: "Acute/Early Rehab", description: "Practice bracing the deep core by simulating a light cough." },
            { id: 218, name: "Seated Postural Correction (Wall Slide)", category: "Motor Control", focus: "Thoracic/Cervical Alignment", injury: "Postural Syndrome", setsReps: "3x10s hold", phase: "All Phases", description: "Sit straight against a wall, focusing on chin tuck and shoulder blade retraction." },
            { id: 219, name: "Resisted Lumbar Flexion (Band)", category: "Motor Control", focus: "Segmental Lumbar Flexion", injury: "Low Back Stenosis", setsReps: "3x10 reps", phase: "Mid Rehab", description: "Use a band around the upper back to resist a gentle crunch motion." },
            { id: 220, name: "Finger Lifts (Table Top)", category: "Motor Control", focus: "Hand/Finger Extensors", injury: "Hand Weakness", setsReps: "3x15 reps", phase: "Early Rehab", description: "Lifting one or two fingers off a flat surface." },
            { id: 221, name: "Single-Leg Stance (Gaze on Moving Target)", category: "Motor Control", focus: "Visual Stability", injury: "Vestibular", setsReps: "3x30s/side", phase: "Advanced Rehab", description: "Maintain balance while tracking a moving object with the eyes." },
            { id: 222, name: "Standing Clock/Cone Pick-Up", category: "Motor Control", focus: "Hip Hinge vs Squat", injury: "Low Back Mechanics", setsReps: "3x10 reps", phase: "Mid Rehab", description: "Practice bending to pick up an object from the floor with good form." },
            { id: 223, name: "Prone Hip Extension (Small Range)", category: "Motor Control", focus: "Glute Firing", injury: "Glute Amnesia", setsReps: "3x15/leg", phase: "Early Rehab", description: "Lift leg slightly off the floor, focusing purely on glute contraction." },
            { id: 224, name: "Seated Trunk Rotation (Segmental)", category: "Motor Control", focus: "Thoracic Mobility", injury: "Low Back Fusion", setsReps: "3x10/side", phase: "Mid Rehab", description: "Rotate the upper body, keeping the lower body completely still." },
            { id: 225, name: "Quadruped Knee Lift (No Pelvic Rotation)", category: "Motor Control", focus: "Glute Medius Control", injury: "Hip Instability", setsReps: "3x15/leg", phase: "Mid Rehab", description: "Lift knee out to the side a few inches; avoid tilting the hips." },
            { id: 226, name: "Wall Angels (Shoulder)", category: "Motor Control", focus: "Shoulder Mobility, Posture", injury: "Postural Syndrome", setsReps: "3x10 reps", phase: "Mid Rehab", description: "Sliding arms up and down a wall, keeping wrists and elbows touching." },
            { id: 227, name: "Ankle Inversion with Band (Controlled)", category: "Motor Control", focus: "Tibialis Posterior", injury: "Foot Stability", setsReps: "3x15", phase: "Mid Rehab", description: "Slow, deliberate movement to control the foot's arch." },
            { id: 228, name: "Resisted Scapular Retraction (Band)", category: "Motor Control", focus: "Rhomboids, Mid Trap", injury: "Postural Correction", setsReps: "3x15", phase: "Mid Rehab", description: "Pulling a resistance band apart between hands, focusing on squeezing shoulder blades." },
            { id: 229, name: "Head/Neck Isolation (Figure 8)", category: "Motor Control", focus: "Cervical Proprioception", injury: "Neck Pain", setsReps: "3x10/direction", phase: "Early Rehab", description: "Slow, small movements of the head in a figure-eight pattern." },
            { id: 230, name: "Bird Dog (Stability Ball Under Knees)", category: "Motor Control", focus: "Advanced Core Stability", injury: "Low Back Instability", setsReps: "3x10/side", phase: "Late Rehab", description: "Performing the Bird Dog exercise with an extremely unstable base." },
            { id: 231, name: "Seated Chin Glide (Micro Movement)", category: "Motor Control", focus: "Deep Neck Flexors", injury: "Cervicogenic Headache", setsReps: "3x10 reps", phase: "Acute/Early Rehab", description: "Small, gentle movement to isolate the deepest neck stabilizers." },
            { id: 232, name: "Supine Core Bracing (Feet Elevated)", category: "Motor Control", focus: "Core Stability", injury: "Low Back Disc", setsReps: "3x30s hold", phase: "Early Rehab", description: "Brace the core while maintaining a stable pelvis with legs relaxed on a chair/box." },
            { id: 233, name: "Standing Pelvic Clocks", category: "Motor Control", focus: "Pelvic Awareness", injury: "Sacroiliac Joint Dysfunction", setsReps: "2x1 minute", phase: "Mid Rehab", description: "Gentle movement of the pelvis to trace a clock face." },
            { id: 234, name: "Prone Cobra (Low Intensity)", category: "Motor Control", focus: "Erectors, Posture", injury: "Low Back Pain", setsReps: "3x10s hold", phase: "Mid Rehab", description: "Gently lift chest, retract shoulder blades, thumbs up; avoid pain." },
            { id: 235, name: "Wrist Radial/Ulnar Deviation (Controlled)", category: "Motor Control", focus: "Wrist Stabilizers", injury: "Wrist Pain", setsReps: "3x15", phase: "Early Rehab", description: "Slow, non-painful movement side-to-side (deviation)." },
            { id: 236, name: "Single-Leg Balance (Tracing Shapes on Floor)", category: "Motor Control", focus: "Foot Proprioception", injury: "Ankle Sprain", setsReps: "3x1 minute/leg", phase: "Mid Rehab", description: "Using the non-weight-bearing foot to lightly trace shapes on the ground." },
            { id: 237, name: "Supine Alternating Knee Drop (Controlled)", category: "Motor Control", focus: "Anti-Rotation Core", injury: "Low Back Instability", setsReps: "3x20 alternating", phase: "Mid Rehab", description: "Drop one knee out to the side a few inches; avoid letting the pelvis tilt." },
            { id: 238, name: "Segmental Rolling (Supine to Prone)", category: "Motor Control", focus: "Trunk Segmentation", injury: "Rotational Control", setsReps: "3x5 rolls/side", phase: "Early-Mid Rehab", description: "Using only the core and head to initiate a roll; highly controlled." },
            { id: 239, name: "Standing Weight Shift (Foot Tripod)", category: "Motor Control", focus: "Foot Arch Control", injury: "Plantar Fasciitis", setsReps: "3x1 minute", phase: "Mid Rehab", description: "Shift weight to engage the 'tripod' points of the foot (heel, big toe, pinky toe)." },
            { id: 240, name: "Ankle Isometrics (All Directions)", category: "Motor Control", focus: "Ankle Stability", injury: "Acute Ankle Sprain", setsReps: "3x10s hold/direction", phase: "Acute Rehab", description: "Gently press foot into a wall or floor in four directions (in, out, up, down)." },
            { id: 241, name: "Prone Extension (McKenzie Low Back)", category: "Motor Control", focus: "Spinal Extension", injury: "Disc Herniation", setsReps: "10x10 reps", phase: "Acute/Early Rehab", description: "Lying on stomach, push up onto elbows/hands if tolerable, then return." },
            { id: 242, name: "Side-Lying Hip Abduction (Precision)", category: "Motor Control", focus: "Glute Medius Isolation", injury: "Hip Bursitis", setsReps: "3x15/leg", phase: "Early-Mid Rehab", description: "Small, slow lift of the leg, ensuring the hip stays forward and stable." },
            { id: 243, name: "Finger/Thumb Opposition", category: "Motor Control", focus: "Hand Dexterity", injury: "Hand Surgery", setsReps: "3x1 minute", phase: "Early Rehab", description: "Touching the thumb to each fingertip in sequence." },
            { id: 244, name: "Seated Knee Extension with Quad Set", category: "Motor Control", focus: "VMO Firing", injury: "Knee Surgery", setsReps: "3x10s hold", phase: "Acute/Early Rehab", description: "Contracting the quad (VMO) forcefully at full knee extension." },
            { id: 245, name: "Static Balance (Eyes Open, Distraction)", category: "Motor Control", focus: "Concentration/Stability", injury: "Concussion", setsReps: "3x60s", phase: "Mid Rehab", description: "Stand normally while reading simple text or listening to music." },
        ];

        // --- GLOBAL STATE & DOM ELEMENTS ---
        let selectedExercises = []; // The list of exercises added to the prescription pad (HEP Pad)
        let currentPage = 'library'; // 'library' or 'programs'

        const resultsContainer = document.getElementById('resultsContainer');
        const searchInput = document.getElementById('searchInput');
        const noResultsMessage = document.getElementById('noResults');
        const exerciseCountSpan = document.getElementById('exerciseCount');
        const jumpToBottomButton = document.getElementById('jumpToBottom');
        const hepPadContent = document.getElementById('hepPadContent');
        const hepPadEmptyMessage = document.getElementById('hepPadEmptyMessage');
        const prescribeButton = document.getElementById('prescribeButton');
        const viewSwitcherBtn = document.getElementById('viewSwitcherBtn');
        
        const libraryView = document.getElementById('libraryView');
        const programsView = document.getElementById('programsView');
        const programsList = document.getElementById('programsList');
        
        const detailModal = document.getElementById('detailModal');
        const messageBox = document.getElementById('messageBox');
        
        window.selectedExercises = selectedExercises; // Expose for clearing after save

        const categoryColorMap = {
            "Strength Training": "strength-border",
            "Stretching/Flexibility": "stretching-border",
            "Balance/Coordination": "balance-border",
            "Functional Exercise": "functional-border",
            "Motor Control": "motor-control-border"
        };
        
        const categoryIconMap = {
            "Strength Training": '',
            "Stretching/Flexibility": '',
            "Balance/Coordination": '',
            "Functional Exercise": '',
            "Motor Control": ''
        };


        // --- UTILITY FUNCTIONS ---
        
        function getBorderClass(category) {
            return categoryColorMap[category] || 'border-l-4 border-gray-400';
        }

        function findExerciseById(id) {
            return exercises.find(ex => ex.id === parseInt(id));
        }
        
        /**
         * Custom message box function (Replaces alert/confirm for general info)
         */
        function showMessage(title, body) {
            document.getElementById('messageTitle').textContent = title;
            document.getElementById('messageBody').textContent = body;
            messageBox.classList.remove('hidden');
        }
        document.getElementById('messageCloseBtn').addEventListener('click', () => {
            messageBox.classList.add('hidden');
        });


        // --- DRAG AND DROP HANDLERS ---
        function handleDragStart(e) {
            // Set the data to be dragged (the exercise ID)
            e.dataTransfer.setData('text/plain', e.target.getAttribute('data-exercise-id'));
            e.target.classList.add('opacity-40');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('opacity-40');
        }

        function handleDragOver(e) {
            e.preventDefault(); // Necessary to allow dropping
            const hepPad = document.getElementById('hepPad');
            hepPad.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            const hepPad = document.getElementById('hepPad');
            hepPad.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            const hepPad = document.getElementById('hepPad');
            hepPad.classList.remove('drag-over');

            const id = e.dataTransfer.getData('text/plain');
            const exercise = findExerciseById(id);

            if (exercise && !selectedExercises.some(ex => ex.id === exercise.id)) {
                selectedExercises.push(exercise);
                window.renderHEPPad();
            }
        }
        
        // --- RENDERING FUNCTIONS (HEP PAD) ---

        window.renderHEPPad = function() {
            hepPadContent.innerHTML = '';
            
            if (selectedExercises.length > 0) {
                hepPadEmptyMessage.classList.add('hidden');
                prescribeButton.disabled = false;
                prescribeButton.textContent = `Generate and Save HEP (${selectedExercises.length} Exercises)`;

                selectedExercises.forEach(exercise => {
                    const listItem = document.createElement('div');
                    const borderColor = getBorderClass(exercise.category);

                    // Updated background and text colors for dark mode
                    listItem.className = `p-3 bg-gray-700 rounded-lg shadow-sm ${borderColor} flex items-center justify-between`;
                    listItem.innerHTML = `
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-bold text-gray-100 truncate">${exercise.name}</p>
                            <p class="text-xs text-gray-400">Sets/Reps: ${exercise.setsReps || 'Varies'}</p>
                        </div>
                        <button class="remove-btn ml-3 p-1 text-red-400 hover:text-red-300 transition-colors" data-id="${exercise.id}">
                            <!-- X Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                        </button>
                    `;
                    hepPadContent.appendChild(listItem);
                });
            } else {
                hepPadEmptyMessage.classList.remove('hidden');
                prescribeButton.disabled = true;
                prescribeButton.textContent = 'Generate and Save HEP (0 Exercises)';
            }
            
            // Re-attach listeners for remove buttons
            hepPadContent.querySelectorAll('.remove-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const idToRemove = parseInt(e.currentTarget.getAttribute('data-id'));
                    selectedExercises = selectedExercises.filter(ex => ex.id !== idToRemove);
                    window.renderHEPPad();
                });
            });
        }
        
        // --- RENDERING FUNCTIONS (LIBRARY) ---

        function renderResults(results) {
            resultsContainer.innerHTML = '';
            exerciseCountSpan.textContent = `${results.length}`;

            if (results.length > 0) {
                noResultsMessage.classList.add('hidden');
                results.forEach(exercise => {
                    const card = document.createElement('div');
                    const borderColor = getBorderClass(exercise.category);
                    
                    card.setAttribute('draggable', 'true');
                    card.setAttribute('data-exercise-id', exercise.id);
                    card.addEventListener('dragstart', handleDragStart);
                    card.addEventListener('dragend', handleDragEnd);

                    card.className = `card bg-gray-800 p-6 rounded-xl ${borderColor} flex flex-col`;
                    card.innerHTML = `
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-xl font-extrabold text-gray-100 flex items-center">
                                ${categoryIconMap[exercise.category] || ''} ${exercise.name}
                            </h3>
                            <span class="text-xs font-semibold px-3 py-1 rounded-full bg-gray-700 text-gray-300 border border-gray-600">${exercise.category}</span>
                        </div>
                        
                        <p class="text-sm text-gray-400 mt-1 mb-3">${exercise.description}</p>
                        
                        <div class="mt-auto pt-3 border-t border-gray-700 flex flex-wrap gap-x-6 gap-y-2 text-sm">
                            <div class="text-blue-400 font-semibold">
                                Sets/Reps: <span class="text-gray-300">${exercise.setsReps || 'Varies'}</span>
                            </div>
                            <div class="text-teal-400 font-semibold">
                                Focus: <span class="text-gray-300">${exercise.focus}</span>
                            </div>
                            <div class="text-orange-400 font-semibold">
                                Phase: <span class="text-gray-300">${exercise.phase}</span>
                            </div>
                        </div>
                    `;
                    resultsContainer.appendChild(card);
                });
            } else {
                noResultsMessage.classList.remove('hidden');
            }
        }

        function handleSearch() {
            const query = searchInput.value.toLowerCase().trim();
            if (query === '') {
                renderResults(exercises);
                return;
            }

            const filteredResults = exercises.filter(exercise => {
                const searchString = `${exercise.name.toLowerCase()} ${exercise.category.toLowerCase()} ${exercise.focus.toLowerCase()} ${exercise.injury.toLowerCase()} ${exercise.description.toLowerCase()} ${exercise.phase.toLowerCase()}`;
                return searchString.includes(query);
            });

            renderResults(filteredResults);
        }
        
        // --- RENDERING FUNCTIONS (PROGRAMS VIEW) ---

        function renderProgramsList() {
            programsList.innerHTML = '';

            if (window.patientPrograms.length === 0) {
                document.getElementById('programsEmpty').classList.remove('hidden');
            } else {
                document.getElementById('programsEmpty').classList.add('hidden');
                
                window.patientPrograms.forEach(program => {
                    const card = document.createElement('div');
                    card.className = "bg-gray-700 p-4 rounded-lg shadow-md flex justify-between items-center border-l-4 border-orange-400 hover:bg-gray-600 transition-colors cursor-pointer";
                    
                    const timestamp = program.timestamp ? new Date(program.timestamp.seconds * 1000).toLocaleDateString() : 'N/A';

                    card.innerHTML = `
                        <div class="flex-1 min-w-0">
                            <h4 class="text-lg font-bold text-gray-100 truncate">${program.patientName}</h4>
                            <p class="text-sm text-gray-400">Exercises: ${program.exercises.length} | Created: ${timestamp}</p>
                        </div>
                        <div class="flex space-x-2">
                            <button data-program-id="${program.id}" class="view-program-btn p-2 rounded-full bg-teal-600 hover:bg-teal-700 text-white transition-colors">
                                <!-- Eye Icon -->
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                            </button>
                            <button data-program-id="${program.id}" class="delete-program-btn p-2 rounded-full bg-red-600 hover:bg-red-700 text-white transition-colors">
                                <!-- Trash Icon -->
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                            </button>
                        </div>
                    `;
                    programsList.appendChild(card);
                });
                
                // Attach event listeners for the new buttons
                programsList.querySelectorAll('.view-program-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const programId = e.currentTarget.getAttribute('data-program-id');
                        viewProgramDetails(programId);
                    });
                });
                
                programsList.querySelectorAll('.delete-program-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const programId = e.currentTarget.getAttribute('data-program-id');
                        window.deleteProgram(programId);
                    });
                });
            }
        }
        
        function viewProgramDetails(programId) {
            const program = window.patientPrograms.find(p => p.id === programId);
            if (!program) {
                showMessage("Error", "Program not found.");
                return;
            }
            
            document.getElementById('detailPatientName').textContent = `HEP for: ${program.patientName}`;
            const exercisesHtml = program.exercises.map(ex => {
                const borderColor = getBorderClass(ex.category);
                return `
                    <div class="p-3 bg-gray-900 rounded-lg shadow-inner ${borderColor}">
                        <p class="text-base font-semibold text-gray-100">${ex.name}</p>
                        <p class="text-xs text-gray-400">${ex.setsReps} | Focus: ${ex.focus}</p>
                    </div>
                `;
            }).join('');
            
            document.getElementById('detailProgramExercises').innerHTML = exercisesHtml;
            detailModal.classList.remove('hidden');
        }


        // --- VIEW SWITCHER ---

        function switchView(viewName) {
            currentPage = viewName;
            
            if (viewName === 'programs') {
                libraryView.classList.add('hidden');
                programsView.classList.remove('hidden');
                viewSwitcherBtn.textContent = 'Back to Library';
                viewSwitcherBtn.classList.remove('bg-orange-500');
                viewSwitcherBtn.classList.add('bg-teal-500');
                jumpToBottomButton.classList.add('hidden'); // Hide scroll button on short view
                renderProgramsList();
            } else { // 'library'
                libraryView.classList.remove('hidden');
                programsView.classList.add('hidden');
                viewSwitcherBtn.textContent = 'View Programs';
                viewSwitcherBtn.classList.remove('bg-teal-500');
                viewSwitcherBtn.classList.add('bg-orange-500');
                // Only show jump to bottom button if the list is long, which it now is.
                jumpToBottomButton.classList.remove('hidden'); 
            }
        }


        // --- EVENT LISTENERS ---

        searchInput.addEventListener('input', handleSearch);

        jumpToBottomButton.addEventListener('click', () => {
            document.getElementById('footer').scrollIntoView({ behavior: 'smooth' });
        });
        
        viewSwitcherBtn.addEventListener('click', () => {
            switchView(currentPage === 'library' ? 'programs' : 'library');
        });

        // Close detail modal
        document.getElementById('detailCloseBtn').addEventListener('click', () => {
            detailModal.classList.add('hidden');
        });

        // Save Program button functionality
        prescribeButton.addEventListener('click', () => {
            if (selectedExercises.length === 0) {
                showMessage("Empty Pad", "Please drag exercises into the Prescription Pad before saving.");
                return;
            }
            
            // Rule: Must not use alert/confirm, using prompt for input is acceptable here.
            const patientName = prompt("Enter the Patient's Name for this program:");

            if (patientName && patientName.trim()) {
                window.saveProgram(patientName.trim(), selectedExercises);
            } else if (patientName !== null) {
                showMessage("Input Required", "Patient name cannot be empty. Program not saved.");
            }
            // If patientName is null (user clicked cancel on prompt), do nothing.
        });


        // Initialize HEP Pad drag/drop listeners (on the pad element itself)
        const hepPad = document.getElementById('hepPad');
        hepPad.addEventListener('dragover', handleDragOver);
        hepPad.addEventListener('dragleave', handleDragLeave);
        hepPad.addEventListener('drop', handleDrop);


        // Initial setup on page load
        document.addEventListener('DOMContentLoaded', () => {
            renderResults(exercises);
            window.renderHEPPad();
            switchView('library'); // Start on the library page
        });
    </script>
</body>
</html>
